<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Nebula Serpent — Rajini Edition</title>
  <style>
    :root{--bg:#020617;--panel:#061025;--accent:#7efcda;--muted:#9fb0c8}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;color:#e6eef8}
    body{display:flex;align-items:center;justify-content:center;background:radial-gradient(1200px 600px at 20% 20%, rgba(14,24,43,0.6), transparent 8%), linear-gradient(180deg,#021026 0%, #021017 100%);}
    .wrap{width:min(900px,96vw);padding:16px;border-radius:14px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);box-shadow:0 20px 50px rgba(2,6,23,0.7)}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
    h1{font-size:18px;margin:0}
    .meta{font-size:13px;color:var(--muted)}
    .content{display:flex;gap:16px}
    .game{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:12px;border-radius:10px}
    canvas{display:block;border-radius:10px;background:linear-gradient(180deg, rgba(0,0,0,0.12), transparent)}
    .controls{display:flex;gap:8px;margin-top:10px}
    button{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);padding:8px 10px;border-radius:8px;font-size:13px; cursor: pointer;}
    .sidebar{min-width:220px;padding:12px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent)}
    .score{font-size:22px;color:var(--accent);margin-bottom:6px}
    .small{font-size:12px;color:var(--muted)}
    .legend{margin-top:10px}
    .legend-item{display:flex;align-items:center;gap:8px;margin:6px 0}
    .dot{width:14px;height:14px;border-radius:50%}
    @media (max-width:760px){.content{flex-direction:column}.sidebar{min-width:unset}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Nebula Serpent</h1>
        <div class="meta">Smooth-segment movement • Dash + power-fruits • Procedural neon visuals</div>
      </div>
      <div class="meta">Unique source & mechanics for you</div>
    </header>

    <div class="content">
      <div class="game">
        <canvas id="c" width="640" height="640"></canvas>
        <div class="controls">
          <button id="start">Start / Restart</button>
          <button id="pause">Pause</button>
          <button id="dash">Dash (Space)</button>
          <button id="music">Sound: On</button>
        </div>
      </div>

      <aside class="sidebar">
        <div class="score">Score: <span id="score">0</span></div>
        <div class="small">High score: <strong id="high">0</strong></div>
        <div style="margin-top:10px" class="small">
          Controls: Arrow keys / WASD to steer. Space to Dash.
        </div>
        <div class="legend">
          <div class="legend-item"><div class="dot" style="background:#ff6b6b"></div> Regular Fruit (+10)</div>
          <div class="legend-item"><div class="dot" style="background:#8b5cf6"></div> Nebula Burst (split head)</div>
          <div class="legend-item"><div class="dot" style="background:#60a5fa"></div> Chrono Berry (slow time)</div>
        </div>
        <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:10px 0">
        
        <div style="margin-top:10px;">
            <div class="small" style="margin-bottom: 6px;">Manual Dialogue</div>
            <input type="text" id="dialogueInput" placeholder="Type text to speak..." style="width: 100%; background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.06); color: white; padding: 6px; border-radius: 4px;">
            <button id="speakBtn" style="width: 100%; margin-top: 6px;">Speak</button>
        </div>

        <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:10px 0">
        <div class="small">This file stores your high score in localStorage under key <code>nebula_serpent_high</code>.</div>
      </aside>
    </div>
  </div>

  <!-- Fruit audio -->
  <audio id="rajiniSound" src="sound.mp3"></audio>
  <!-- Death audio -->
  <audio id="rajiniDeath" src="rajini_feareless_ag.mp3"></audio>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
const startBtn = document.getElementById('start');
const pauseBtn = document.getElementById('pause');
const dashBtn = document.getElementById('dash');
const musicBtn = document.getElementById('music');
const scoreEl = document.getElementById('score');
const highEl = document.getElementById('high');

const dialogueInput = document.getElementById('dialogueInput');
const speakBtn = document.getElementById('speakBtn');
const rajiniSound = document.getElementById('rajiniSound');
const rajiniDeath = document.getElementById('rajiniDeath');
const rajiniHeadImg = new Image();
rajiniHeadImg.src = 'rajinikanth.jpg';

const sunglassesImg = new Image();
sunglassesImg.src = 'glasses.png';

// speech synthesis
function speakText(text) {
  if ('speechSynthesis' in window) {
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.pitch = 1.2;
    utterance.rate = 1.1;
    window.speechSynthesis.speak(utterance);
  }
}
speakBtn.addEventListener('click', () => {
  const textToSpeak = dialogueInput.value;
  if (textToSpeak.trim() !== '') speakText(textToSpeak);
});

// game vars
const GRID = 24;
let cellPx;
let snakeSpeed = 4, originalSpeed = 4;
let moveCounter = 0;
let snake, dir, nextDir, food, obstacles, portals;
let running = false, paused = false;
let score = 0, high = Number(localStorage.getItem('nebula_serpent_high') || 0);
let dashCooldown = 0, dashReady = true;
let splitHeadRemaining = 0;
let timeScale = 1.0;
let audioOn = true;

// palette
let palette = {};
function generatePalette(){
  const base = Math.floor(Math.random()*360);
  const neon = (h, s=80, l=55) => `hsl(${(base+h)%360} ${s}% ${l}%)`;
  palette = {
    bg: '#020617',
    grid: 'rgba(255,255,255,0.02)',
    body: neon(30,85,45),
    regular: '#ff6b6b',
    burst: '#8b5cf6',
    chrono: '#60a5fa',
    obstacle: 'rgba(255,255,255,0.06)'
  };
}

function init(){
  generatePalette();
  highEl.textContent = high;
  cellPx = canvas.width / GRID;
  snakeSpeed = 4; originalSpeed = 4;
  moveCounter = 0;
  const cx = Math.floor(GRID/2);
  const cy = Math.floor(GRID/2);
  snake = [];
  for(let i=0;i<6;i++) snake.push({x:cx - i, y:cy, sx:cx - i, sy:cy});
  dir = {x:1,y:0}; nextDir = null;
  score = 0; scoreEl.textContent = score;
  dashCooldown = 0; dashReady = true; splitHeadRemaining = 0; timeScale = 1.0;
  obstacles = []; portals = [];
  placeFood();
  running = true; paused = false;
}

function placeFood(){
  while(true){
    let x = Math.floor(Math.random()*GRID);
    let y = Math.floor(Math.random()*GRID);
    if(snake.some(s=>s.x===x && s.y===y)) continue;
    food = {x,y,type:'regular'};
    return;
  }
}

function tick(){
  if(!running || paused) return;
  if(nextDir){ if(!(nextDir.x === -dir.x && nextDir.y === -dir.y)) dir = nextDir; nextDir=null; }
  moveCounter += timeScale;
  if(moveCounter < snakeSpeed){ updateSmoothPositions(); return; }
  moveCounter = 0;
  const head = {x: snake[0].x + dir.x, y: snake[0].y + dir.y};
  if(head.x<0||head.x>=GRID||head.y<0||head.y>=GRID||snake.some((s,idx)=>idx>0 && s.x===head.x && s.y===head.y)){
    gameOver(); return;
  }
  snake.unshift({x:head.x,y:head.y,sx:head.x,sy:head.y});
  if(food && head.x===food.x && head.y===food.y){
    score+=10; scoreEl.textContent=score;
    if(audioOn){rajiniSound.currentTime=0;rajiniSound.play();}
    placeFood();
  } else snake.pop();
  updateSmoothPositions();
}

function updateSmoothPositions() {
  for(let i=0; i<snake.length; i++){
    let seg = snake[i];
    let leader = i>0 ? snake[i-1] : seg;
    seg.sx += (leader.x - seg.sx) * 0.35;
    seg.sy += (leader.y - seg.sy) * 0.35;
  }
}

function draw(){
  ctx.fillStyle = palette.bg; ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.strokeStyle = 'rgba(159, 176, 200, 0.4)'; // A semi-transparent border color
ctx.lineWidth = 8; // How thick the wall is
ctx.strokeRect(0, 0, canvas.width, canvas.height);
  if(food){
    ctx.fillStyle=palette.regular;
    ctx.beginPath();
    ctx.arc((food.x+0.5)*cellPx,(food.y+0.5)*cellPx,cellPx*0.3,0,Math.PI*2);
    ctx.fill();
  }
  for(let i=snake.length-1;i>=0;i--){
    const s=snake[i];
    if (i === 0) { // If it is the head, draw the image
      const centerX = (s.sx + 0.5) * cellPx;
      const centerY = (s.sy + 0.5) * cellPx;

      ctx.save(); // Save the current canvas state
      ctx.translate(centerX, centerY); // Move to the center of the head

      const angle = Math.atan2(dir.y, dir.x); // Calculate rotation angle
      ctx.rotate(angle); // Rotate the canvas

      // Draw the image centered on the new rotated origin
      ctx.drawImage(rajiniHeadImg, -cellPx/2, -cellPx/2, cellPx, cellPx);

      ctx.restore(); // Restore the canvas to its original state
    } else { // Otherwise, draw the body
      ctx.fillStyle=palette.body;
      ctx.beginPath();
      ctx.arc((s.sx+0.5)*cellPx,(s.sy+0.5)*cellPx,cellPx*0.4,0,Math.PI*2);
      ctx.fill();
    }
  }
}


function gameOver(){
  running=false; paused=false;
  if(score>high){high=score;localStorage.setItem('nebula_serpent_high',String(high));highEl.textContent=high;}
  // play death audio
  if(audioOn){rajiniDeath.currentTime=0;rajiniDeath.play();}
  setTimeout(()=>{ if(confirm('Game Over! Score: '+score+'. Play again?')) init(); }, 200);
}

function loop(){
  if(!paused) tick();
  draw();
  requestAnimationFrame(loop);
}

window.addEventListener('keydown', (e)=>{
  // A list of keys our game uses for movement
  const gameKeys = ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', ' '];

  // If the pressed key is in our list, stop the browser's default action
  if (gameKeys.includes(e.key)) {
    e.preventDefault();
  }


  if(e.key==='ArrowUp') nextDir={x:0,y:-1};
  if(e.key==='ArrowDown') nextDir={x:0,y:1};
  if(e.key==='ArrowLeft') nextDir={x:-1,y:0};
  if(e.key==='ArrowRight') nextDir={x:1,y:0};
  if(e.key==='p') paused=!paused;
});
startBtn.addEventListener('click', ()=>init());
pauseBtn.addEventListener('click', ()=>{if(running) paused=!paused;});
musicBtn.addEventListener('click', ()=>{audioOn=!audioOn;musicBtn.textContent='Sound: '+(audioOn?'On':'Off');});

init();
requestAnimationFrame(loop);
</script>
</body>
</html>

